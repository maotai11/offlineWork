<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="完全離線的工作管理应用">
  <meta name="theme-color" content="#13171f">
  <title>離線工作管理系統</title>
  
  <!-- 本地样式 -->
  <link rel="stylesheet" href="./libs/flatpickr.min.css">
  <link rel="stylesheet" href="./styles.css">
  
  <!-- Manifest -->
  <link rel="manifest" href="./manifest.json">
</head>
<body>
  <!-- 主容器 -->
  <div id="app">
    <!-- 导航栏 -->
    <nav class="navbar">
      <div class="nav-container">
        <h1 class="app-title">離線工作管理</h1>
        <div class="nav-actions">
          <button id="searchBtn" class="btn-icon" title="搜尋">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
          <button id="exportBtn" class="btn-icon" title="匯出PDF">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
          <button id="settingsBtn" class="btn-icon" title="設定">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6"></path>
              <path d="m1 12 6 0m6 0 6 0"></path>
            </svg>
          </button>
        </div>
      </div>
    </nav>

    <!-- 標籤页 -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="calendar">月曆檢視</button>
      <button class="tab-btn" data-tab="work">工作紀錄</button>
      <button class="tab-btn" data-tab="todos">代辦事項</button>
      <button class="tab-btn" data-tab="checks">核對事項</button>
    </div>

    <!-- 主內容区 -->
    <main class="main-content">
      <!-- 月曆檢視 -->
      <section id="calendarView" class="view active">
        <div class="view-header">
          <button id="prevMonth" class="btn-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 id="currentMonth"></h2>
          <button id="nextMonth" class="btn-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
        <div id="calendar" class="calendar-grid"></div>
        <div id="dayDetails" class="day-details hidden"></div>
      </section>

      <!-- 工作紀錄檢視 -->
      <section id="workView" class="view">
        <div class="view-header">
          <h2>工作紀錄</h2>
          <button id="addWorkBtn" class="btn-primary">+ 新增紀錄</button>
        </div>
        <div id="workList" class="item-list"></div>
      </section>

      <!-- 代辦事項檢視 -->
      <section id="todosView" class="view">
        <div class="view-header">
          <h2>代辦事項</h2>
          <div class="header-actions">
            <button id="addTodoBtn" class="btn-primary">+ 新增代辦</button>
            <button id="todoTemplateBtn" class="btn-secondary">模板</button>
          </div>
        </div>
        <div class="filter-tabs">
          <button class="filter-btn active" data-filter="all">全部</button>
          <button class="filter-btn" data-filter="active">進行中</button>
          <button class="filter-btn" data-filter="completed">已完成</button>
          <button class="filter-btn" data-filter="high">高优先</button>
        </div>
        <div id="todoList" class="item-list sortable"></div>
      </section>

      <!-- 核對事項檢視 -->
      <section id="checksView" class="view">
        <div class="view-header">
          <h2>每期核對事項</h2>
          <button id="addCheckBtn" class="btn-primary">+ 新增核對</button>
        </div>
        <div id="checkList" class="item-list"></div>
      </section>
    </main>
  </div>

  <!-- 搜尋模态框 -->
  <div id="searchModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>搜尋</h3>
        <button class="btn-close" data-modal="searchModal">&times;</button>
      </div>
      <div class="modal-body">
        <input type="text" id="searchInput" class="input-text" placeholder="輸入關鍵字搜尋...">
        <div id="searchResults" class="search-results"></div>
      </div>
    </div>
  </div>

  <!-- 工作紀錄表单模态框 -->
  <div id="workModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="workModalTitle">新增工作紀錄</h3>
        <button class="btn-close" data-modal="workModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="workForm">
          <input type="hidden" id="workId">
          
          <div class="form-group">
            <label for="workDate">日期</label>
            <input type="text" id="workDate" class="input-text datepicker" required>
          </div>
          
          <div class="form-group">
            <label for="workContent">工作內容</label>
            <textarea id="workContent" class="input-textarea" rows="6" required></textarea>
          </div>
          
          <div class="form-group">
            <label for="workImages">圖片（可選）</label>
            <input type="file" id="workImages" accept="image/*" multiple class="input-file">
            <div id="imagePreview" class="image-preview"></div>
          </div>
          
          <div class="form-group">
            <label for="workTags">標籤（用逗号分隔）</label>
            <input type="text" id="workTags" class="input-text" placeholder="例如: 會議, 開發, 測試">
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" data-modal="workModal">取消</button>
            <button type="submit" class="btn-primary">儲存</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 代辦事項表单模态框 -->
  <div id="todoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="todoModalTitle">新增代辦事項</h3>
        <button class="btn-close" data-modal="todoModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="todoForm">
          <input type="hidden" id="todoId">
          
          <div class="form-group">
            <label for="todoTitle">任務標題</label>
            <input type="text" id="todoTitle" class="input-text" required>
          </div>
          
          <div class="form-group">
            <label for="todoPriority">優先級</label>
            <select id="todoPriority" class="input-select">
              <option value="low">低</option>
              <option value="medium" selected>中</option>
              <option value="high">高</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="todoDueDate">預計完成日</label>
            <input type="text" id="todoDueDate" class="input-text datepicker">
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" data-modal="todoModal">取消</button>
            <button type="submit" class="btn-primary">儲存</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 核對事項表单模态框 -->
  <div id="checkModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="checkModalTitle">新增核對事項</h3>
        <button class="btn-close" data-modal="checkModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="checkForm">
          <input type="hidden" id="checkId">
          
          <div class="form-group">
            <label for="checkTitle">事項名称</label>
            <input type="text" id="checkTitle" class="input-text" required>
          </div>
          
          <div class="form-group">
            <label for="checkUser">負責人/部门</label>
            <input type="text" id="checkUser" class="input-text" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="checkPeriodValue">週期數值</label>
              <input type="number" id="checkPeriodValue" class="input-text" min="1" value="1" required>
            </div>
            
            <div class="form-group">
              <label for="checkPeriodType">週期类型</label>
              <select id="checkPeriodType" class="input-select">
                <option value="daily">日</option>
                <option value="weekly">周</option>
                <option value="monthly">月</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" data-modal="checkModal">取消</button>
            <button type="submit" class="btn-primary">儲存</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 匯出选項模态框 -->
  <div id="exportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>匯出 PDF</h3>
        <button class="btn-close" data-modal="exportModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="export-options">
          <button class="export-option-btn" data-export="all">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span>全部匯出</span>
          </button>
          <button class="export-option-btn" data-export="calendar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>月曆檢視</span>
          </button>
          <button class="export-option-btn" data-export="work">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>工作紀錄</span>
          </button>
          <button class="export-option-btn" data-export="todos">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 11 12 14 22 4"></polyline>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span>代辦事項</span>
          </button>
          <button class="export-option-btn" data-export="checks">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>核對事項</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast 通知 -->
  <div id="toast" class="toast"></div>

  <!-- 加载第三方库 -->
  <script src="./libs/dexie.min.js"></script>
  <script src="./libs/flatpickr.min.js"></script>
  <script src="./libs/sortable.min.js"></script>
  <script src="./libs/html2canvas.min.js"></script>
  <script src="./libs/jspdf.umd.min.js"></script>
  <script src="./libs/browser-image-compression.js"></script>
  
  <!-- 应用脚本 -->
  <script src="./db.js"></script>
  <script src="./app.js"></script>
</body>
</html>
