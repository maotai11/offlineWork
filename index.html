<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="å®Œå…¨é›¢ç·šçš„å·¥ä½œç®¡ç†åº”ç”¨">
  <meta name="theme-color" content="#13171f">
  <title>é›¢ç·šå·¥ä½œç®¡ç†ç³»çµ±</title>
  
  <!-- æœ¬åœ°æ ·å¼ -->
  <link rel="stylesheet" href="./libs/flatpickr.min.css">
  <link rel="stylesheet" href="./styles.css">
  
  <!-- Manifest -->
  <link rel="manifest" href="./manifest.json">

    <style>
        /* æ·±è‰²æ¨¡å¼è®Šæ•¸ */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #242424;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #404040;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        /* æ‡‰ç”¨è®Šæ•¸åˆ°å…ƒç´  */
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .container, .section {
            background-color: var(--bg-card);
            color: var(--text-primary);
        }

        .work-log-item, .todo-item, .checklist-item,
        .calendar-day, input, textarea, select {
            background-color: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        .calendar-day:hover {
            background-color: var(--bg-secondary);
        }

        /* æ·±è‰²æ¨¡å¼æŒ‰éˆ• */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 8px var(--shadow);
            z-index: 1000;
            transition: all 0.3s;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }
    
        /* æµ®å‹•æ–°å¢æŒ‰éˆ• (FAB) */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 999;
        }

        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .fab-container.active .fab-menu {
            display: flex;
        }

        .fab-main {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-main:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }

        .fab-container.active .fab-main {
            transform: rotate(45deg);
        }

        .fab-item {
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }

        .fab-container.active .fab-item {
            opacity: 1;
            transform: translateY(0);
        }

        .fab-container.active .fab-item:nth-child(1) { transition-delay: 0.05s; }
        .fab-container.active .fab-item:nth-child(2) { transition-delay: 0.1s; }
        .fab-container.active .fab-item:nth-child(3) { transition-delay: 0.15s; }

        .fab-item button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .fab-item button:hover {
            transform: scale(1.1);
        }

        .fab-item .fab-work {
            background: #10b981;
        }

        .fab-item .fab-todo {
            background: #3b82f6;
        }

        .fab-item .fab-check {
            background: #f59e0b;
        }

        .fab-label {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border-color);
        }

    </style>

</head>
<body>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="åˆ‡æ›æ·±è‰²æ¨¡å¼">
        <span id="darkModeIcon">ğŸŒ™</span>
    </button>

  <!-- ä¸»å®¹å™¨ -->
  <div id="app">
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
      <div class="nav-container">
        <h1 class="app-title">é›¢ç·šå·¥ä½œç®¡ç†</h1>
        <div class="nav-actions">
          <button id="searchBtn" class="btn-icon" title="æœå°‹">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
          <button id="exportBtn" class="btn-icon" title="åŒ¯å‡ºPDF">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
          <button id="settingsBtn" class="btn-icon" title="è¨­å®š">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6"></path>
              <path d="m1 12 6 0m6 0 6 0"></path>
            </svg>
          </button>
        </div>
      </div>
    </nav>

    <!-- æ¨™ç±¤é¡µ -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="calendar">æœˆæ›†æª¢è¦–</button>
      <button class="tab-btn" data-tab="work">å·¥ä½œç´€éŒ„</button>
      <button class="tab-btn" data-tab="todos">ä»£è¾¦äº‹é …</button>
      <button class="tab-btn" data-tab="checks">æ ¸å°äº‹é …</button>
    </div>

    <!-- ä¸»å…§å®¹åŒº -->
    <main class="main-content">
      <!-- æœˆæ›†æª¢è¦– -->
      <section id="calendarView" class="view active">
        <div class="view-header">
          <button id="prevMonth" class="btn-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 id="currentMonth"></h2>
          <button id="nextMonth" class="btn-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
        <div id="calendar" class="calendar-grid"></div>
        <div id="dayDetails" class="day-details hidden"></div>
      </section>

      <!-- å·¥ä½œç´€éŒ„æª¢è¦– -->
      <section id="workView" class="view">
        <div class="view-header">
          <h2>å·¥ä½œç´€éŒ„</h2>
          <button id="addWorkBtn" class="btn-primary">+ æ–°å¢ç´€éŒ„</button>
        </div>
        <div id="workList" class="item-list"></div>
      </section>

      <!-- ä»£è¾¦äº‹é …æª¢è¦– -->
      <section id="todosView" class="view">
        <div class="view-header">
          <h2>ä»£è¾¦äº‹é …</h2>
          <div class="header-actions">
            <button id="addTodoBtn" class="btn-primary">+ æ–°å¢ä»£è¾¦</button>
            <button id="todoTemplateBtn" class="btn-secondary">æ¨¡æ¿</button>
          </div>
        </div>
        <div class="filter-tabs">
          <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
          <button class="filter-btn" data-filter="active">é€²è¡Œä¸­</button>
          <button class="filter-btn" data-filter="completed">å·²å®Œæˆ</button>
          <button class="filter-btn" data-filter="high">é«˜ä¼˜å…ˆ</button>
        </div>
        <div id="todoList" class="item-list sortable"></div>
      </section>

      <!-- æ ¸å°äº‹é …æª¢è¦– -->
      <section id="checksView" class="view">
        <div class="view-header">
          <h2>æ¯æœŸæ ¸å°äº‹é …</h2>
          <button id="addCheckBtn" class="btn-primary">+ æ–°å¢æ ¸å°</button>
        </div>
        <div id="checkList" class="item-list"></div>
      </section>
    </main>
  </div>

  <!-- æœå°‹æ¨¡æ€æ¡† -->
  <div id="searchModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æœå°‹</h3>
        <button class="btn-close" data-modal="searchModal">&times;</button>
      </div>
      <div class="modal-body">
        <input type="text" id="searchInput" class="input-text" placeholder="è¼¸å…¥é—œéµå­—æœå°‹...">
        <div id="searchResults" class="search-results"></div>
      </div>
    </div>
  </div>

  <!-- å·¥ä½œç´€éŒ„è¡¨å•æ¨¡æ€æ¡† -->
  <div id="workModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="workModalTitle">æ–°å¢å·¥ä½œç´€éŒ„</h3>
        <button class="btn-close" data-modal="workModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="workForm">
          <input type="hidden" id="workId">
          
          <div class="form-group">
            <label for="workDate">æ—¥æœŸ</label>
            <input type="text" id="workDate" class="input-text datepicker" required>
          </div>
          
          <div class="form-group">
            <label for="workContent">å·¥ä½œå…§å®¹</label>
            <textarea id="workContent" class="input-textarea" rows="6" required></textarea>
          </div>
          
          <div class="form-group">
            <label for="workImages">åœ–ç‰‡ï¼ˆå¯é¸ï¼‰</label>
            <input type="file" id="workImages" accept="image/*" multiple class="input-file">
            <div id="imagePreview" class="image-preview"></div>
          </div>
          
          <div class="form-group">
            <label for="workTags">æ¨™ç±¤ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
            <input type="text" id="workTags" class="input-text" placeholder="ä¾‹å¦‚: æœƒè­°, é–‹ç™¼, æ¸¬è©¦">
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" data-modal="workModal">å–æ¶ˆ</button>
            <button type="submit" class="btn-primary">å„²å­˜</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ä»£è¾¦äº‹é …è¡¨å•æ¨¡æ€æ¡† -->
  <div id="todoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="todoModalTitle">æ–°å¢ä»£è¾¦äº‹é …</h3>
        <button class="btn-close" data-modal="todoModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="todoForm">
          <input type="hidden" id="todoId">
          
          <div class="form-group">
            <label for="todoTitle">ä»»å‹™æ¨™é¡Œ</label>
            <input type="text" id="todoTitle" class="input-text" required>
          </div>
          
          <div class="form-group">
            <label for="todoPriority">å„ªå…ˆç´š</label>
            <select id="todoPriority" class="input-select">
              <option value="low">ä½</option>
              <option value="medium" selected>ä¸­</option>
              <option value="high">é«˜</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="todoDueDate">é è¨ˆå®Œæˆæ—¥</label>
            <input type="text" id="todoDueDate" class="input-text datepicker">
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" data-modal="todoModal">å–æ¶ˆ</button>
            <button type="submit" class="btn-primary">å„²å­˜</button>
          
          <div class="form-group">
            <label>é‡è¤‡è¨­å®š</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <label style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="todoRecurringEnabled" style="width: auto;">
                <span>é‡è¤‡</span>
              </label>
              <input 
                type="number" 
                id="todoRecurringValue" 
                min="1" 
                max="365" 
                value="1"
                placeholder="æ•¸å€¼"
                style="width: 80px;"
                disabled
              >
              <select id="todoRecurringUnit" style="width: 100px;" disabled>
                <option value="day">æ—¥</option>
                <option value="week">é€±</option>
                <option value="month">æœˆ</option>
              </select>
            </div>
            <small style="color: #666;">å•Ÿç”¨å¾Œï¼Œå®Œæˆæ­¤ä»»å‹™å°‡è‡ªå‹•å»ºç«‹ä¸‹ä¸€å€‹é€±æœŸçš„ä»»å‹™</small>
          </div></div>
        </form>
      </div>
    </div>
  </div>

  <!-- æ ¸å°äº‹é …è¡¨å•æ¨¡æ€æ¡† -->
  <div id="checkModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="checkModalTitle">æ–°å¢æ ¸å°äº‹é …</h3>
        <button class="btn-close" data-modal="checkModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="checkForm">
          <input type="hidden" id="checkId">
          
          <div class="form-group">
            <label for="checkTitle">äº‹é …åç§°</label>
            <input type="text" id="checkTitle" class="input-text" required>
          </div>
          
          <div class="form-group">
            <label for="checkUser">è² è²¬äºº/éƒ¨é—¨</label>
            <input type="text" id="checkUser" class="input-text" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="checkPeriodValue">é€±æœŸæ•¸å€¼</label>
              <input type="number" id="checkPeriodValue" class="input-text" min="1" value="1" required>
            </div>
            
            <div class="form-group">
              <label for="checkPeriodType">é€±æœŸç±»å‹</label>
              <select id="checkPeriodType" class="input-select">
                <option value="daily">æ—¥</option>
                <option value="weekly">å‘¨</option>
                <option value="monthly">æœˆ</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" data-modal="checkModal">å–æ¶ˆ</button>
            <button type="submit" class="btn-primary">å„²å­˜</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- åŒ¯å‡ºé€‰é …æ¨¡æ€æ¡† -->
  <div id="exportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>åŒ¯å‡º PDF</h3>
        <button class="btn-close" data-modal="exportModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="export-options">
          <button class="export-option-btn" data-export="all">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span>å…¨éƒ¨åŒ¯å‡º</span>
          </button>
          <button class="export-option-btn" data-export="calendar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>æœˆæ›†æª¢è¦–</span>
          </button>
          <button class="export-option-btn" data-export="work">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>å·¥ä½œç´€éŒ„</span>
          </button>
          <button class="export-option-btn" data-export="todos">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 11 12 14 22 4"></polyline>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span>ä»£è¾¦äº‹é …</span>
          </button>
          <button class="export-option-btn" data-export="checks">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>æ ¸å°äº‹é …</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast é€šçŸ¥ -->
  <div id="toast" class="toast"></div>

  <!-- åŠ è½½ç¬¬ä¸‰æ–¹åº“ -->
  <script src="./libs/dexie.min.js"></script>
  <script src="./libs/flatpickr.min.js"></script>
  <script src="./libs/sortable.min.js"></script>
  <script src="./libs/html2canvas.min.js"></script>
  <script src="./libs/jspdf.umd.min.js"></script>
  <script src="./libs/browser-image-compression.js"></script>
  
  <!-- åº”ç”¨è„šæœ¬ -->
  <script src="./db.js"></script>
  <script src="./app.js"></script>

    <!-- æµ®å‹•æ–°å¢æŒ‰éˆ• (FAB) -->
    <div class="fab-container" id="fabContainer">
        <div class="fab-menu">
            <div class="fab-item">
                <span class="fab-label">æ–°å¢å·¥ä½œç´€éŒ„</span>
                <button class="fab-work" onclick="openWorkModal(); closeFAB();" title="æ–°å¢å·¥ä½œç´€éŒ„">ğŸ“</button>
            </div>
            <div class="fab-item">
                <span class="fab-label">æ–°å¢ä»£è¾¦äº‹é …</span>
                <button class="fab-todo" onclick="openTodoModal(); closeFAB();" title="æ–°å¢ä»£è¾¦äº‹é …">âœ“</button>
            </div>
            <div class="fab-item">
                <span class="fab-label">æ–°å¢æ ¸å°æ¸…å–®</span>
                <button class="fab-check" onclick="openCheckModal(); closeFAB();" title="æ–°å¢æ ¸å°æ¸…å–®">â˜‘</button>
            </div>
        </div>
        <button class="fab-main" onclick="toggleFAB()">+</button>
    </div>

    <script>
        function toggleFAB() {
            document.getElementById('fabContainer').classList.toggle('active');
        }

        function closeFAB() {
            document.getElementById('fabContainer').classList.remove('active');
        }

        // é»æ“Šå¤–éƒ¨é—œé–‰ FAB
        document.addEventListener('click', function(e) {
            const fab = document.getElementById('fabContainer');
            if (fab && !fab.contains(e.target)) {
                fab.classList.remove('active');
            }
        });

        // é€™äº›å‡½æ•¸éœ€è¦å°æ‡‰åˆ°ä½ çš„å¯¦éš›æ¨¡æ…‹æ¡†é–‹å•Ÿå‡½æ•¸
        function openWorkModal() {
            // è§¸ç™¼å·¥ä½œç´€éŒ„çš„æ–°å¢æŒ‰éˆ•
            const addBtn = document.querySelector('.work-logs button');
            if (addBtn) addBtn.click();
        }

        function openTodoModal() {
            // è§¸ç™¼ä»£è¾¦äº‹é …çš„æ–°å¢æŒ‰éˆ•
            const addBtn = document.querySelector('.todos button');
            if (addBtn) addBtn.click();
        }

        function openCheckModal() {
            // è§¸ç™¼æ ¸å°æ¸…å–®çš„æ–°å¢æŒ‰éˆ•
            const addBtn = document.querySelector('.checklists button');
            if (addBtn) addBtn.click();
        }
    </script>

</body>
</html>
